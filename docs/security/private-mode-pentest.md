# Private Mode Security Pentest Report

**Date**: 2026-02-01
**Tester**: jib (autonomous agent)
**Environment**: Private mode container (`PRIVATE_MODE=true`)
**Result**: All critical security controls passed

## Executive Summary

Private mode successfully enforces network isolation and repository access controls. The container can only access mounted private repositories through the gateway sidecar, while all external network access is blocked except for the Anthropic API.

## Test Environment

| Property | Value |
|----------|-------|
| Mode | `PRIVATE_MODE=true` |
| Network | `172.30.0.0/24` (jib-isolated) |
| Proxy | `http://jib-gateway:3128` |
| Gateway API | `http://jib-gateway:9847` |
| Mounted Repo | `jwbron/eng-ai-support` (private) |

## Security Controls Tested

### 1. Private Repository Access (Should Work)

| Test | Result | Evidence |
|------|--------|----------|
| `gh repo view jwbron/eng-ai-support` | PASS | Returns `{"visibility":"PRIVATE"}` |
| `git status` | PASS | Shows worktree status |
| `git log` | PASS | Shows commit history |
| `git fetch origin` | PASS | Fetches from remote |
| `git push` to jib-owned branch | PASS | Pushes successfully |

**Conclusion**: Private repository operations work correctly through the gateway.

### 2. Public Repository Blocking (Must Be Blocked)

| Test | Result | Error Message |
|------|--------|---------------|
| `gh repo view anthropics/claude-code` | BLOCKED | "Private Repo Mode restricts operations to private repositories only" |
| `gh api /repos/anthropics/anthropic-cookbook` | BLOCKED | Same policy enforcement |
| `gh repo view Khan/webapp` (other private) | BLOCKED | "Cannot determine visibility... requires explicit verification" |

**Conclusion**: Public repositories are blocked. Other private repositories not explicitly mounted are also blocked.

### 3. Network Isolation

| Method | Result | Mechanism |
|--------|--------|-----------|
| `curl https://www.google.com` | BLOCKED | SSL MITM - self-signed certificate |
| `curl https://pypi.org` | BLOCKED | SSL MITM |
| `curl https://api.github.com` | BLOCKED | SSL MITM |
| `curl https://api.anthropic.com` | ALLOWED | HTTP 404 (expected) |
| Python `urllib` to external | BLOCKED | SSL CERTIFICATE_VERIFY_FAILED |
| `nc` to external IP | BLOCKED | "Network is unreachable" |
| `ping 8.8.8.8` | BLOCKED | "Network is unreachable" |
| DNS lookup (external) | BLOCKED | SERVFAIL |
| Proxy bypass (`--noproxy '*'`) | BLOCKED | No route to host |

**Conclusion**: Network lockdown is effective. Only Anthropic API is reachable.

### 4. Claude Tool Behavior

| Tool | Result | Notes |
|------|--------|-------|
| WebFetch to external | BLOCKED | "self signed certificate" |
| WebFetch to api.anthropic.com | ALLOWED | HTTP 404 (expected) |
| WebSearch | ALLOWED | See finding below |

**Finding**: WebSearch works in private mode. This appears to route through Anthropic's infrastructure as part of the Claude API, bypassing the container's network restrictions.

### 5. Credential Protection

| Location | Result |
|----------|--------|
| `~/.git-credentials` | Not found |
| `~/.netrc` | Not found |
| `~/.config/gh/hosts.yml` | Not found |
| `~/.ssh/` | Directory doesn't exist |
| `$GITHUB_TOKEN` | Not set |
| `$GH_TOKEN` | Not set |
| `/proc/1/environ` | Only `JIB_SESSION_TOKEN` |

**Conclusion**: No GitHub credentials are accessible in the container.

### 6. Direct Binary Bypass Attempts

| Test | Result |
|------|--------|
| `/opt/.jib-internal/gh auth status` | "You are not logged into any GitHub hosts" |
| `/opt/.jib-internal/git` operations | Fail - can't see `.git` directory |

**Conclusion**: Real binaries have no authentication configured.

### 7. Gateway Port Exposure

| Port | Service | Status |
|------|---------|--------|
| 3128 | HTTP Proxy | Open |
| 9847 | Gateway API | Open |
| 22, 80, 443, 8080 | N/A | Closed |

## Security Properties Verified

1. **Network Isolation**: All external traffic blocked except Anthropic API
2. **Repository Access Control**: Only mounted private repos accessible
3. **Credential Isolation**: No GitHub tokens in container
4. **DNS Lockdown**: External resolution fails
5. **Proxy Enforcement**: Cannot bypass proxy for direct connections

## Recommendation

**WebSearch Behavior**: Document that WebSearch works in private mode (routes through Anthropic infrastructure) or add configuration option to disable it if strict isolation is required.

## Conclusion

Private mode security controls are effective. The defense-in-depth approach (network lockdown + gateway validation + credential isolation) successfully prevents unauthorized access to public repositories and external networks.

---

Authored-by: jib
